<!doctype html>
<html lang="bg" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index, follow">

    <link rel="icon" type="image/x-icon" href="/assets/img/HistAdrLogoOrig2.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/Historyaddress.bg2.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
    <meta name="msapplication-TileImage" content="/assets/img/Historyaddress.bg2.png">

    <title>–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</title>
    <meta name="description" content="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∞–¥—Ä–µ—Å–∏ –∏ –¥–æ–º–æ–≤–µ –≤ –ë—ä–ª–≥–∞—Ä–∏—è">
    <link rel="canonical" href="https://historyaddress.bg/address.html">

    <meta property="og:type" content="article">
    <meta property="og:url" content="https://historyaddress.bg/address.html">
    <meta property="og:title" content="–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞">
    <meta property="og:description" content="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∞–¥—Ä–µ—Å–∏ –∏ –¥–æ–º–æ–≤–µ –≤ –ë—ä–ª–≥–∞—Ä–∏—è">
    <meta property="og:image" content="https://historyaddress.bg/assets/img/HistAdrLogo.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://historyaddress.bg/address.html">
    <meta property="twitter:title" content="–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞">
    <meta property="twitter:description" content="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∞–¥—Ä–µ—Å–∏ –∏ –¥–æ–º–æ–≤–µ –≤ –ë—ä–ª–≥–∞—Ä–∏—è">
    <meta property="twitter:image" content="https://historyaddress.bg/assets/img/HistAdrLogo.png">

    <script>
        (function() {
            try {
                var stored = localStorage.getItem('theme-preference');
                if (stored === 'system') stored = 'dark';
                var theme = (stored === 'dark' || stored === 'light') ? stored : 'dark';
                document.documentElement.setAttribute('data-theme', theme);
            } catch(e) {}
        })();
    </script>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script defer src="assets/js/theme.js"></script>
    <script defer src="assets/js/transitions.js"></script>
    <script defer src="assets/js/calendar-popup.js"></script>
</head>
<script>
function handleEmailClick(event) {
    // On mobile (screen width < 768px), let mailto work normally
    if (window.innerWidth <= 768) {
        return; // Don't prevent default, let mailto: work
    }
    
    // On desktop, show modal
    event.preventDefault();
    showEmailModal();
}

function showEmailModal() {
    var modal = document.getElementById('emailModal');
    if (!modal) {
        // Create modal if it doesn't exist
        modal = document.createElement('div');
        modal.id = 'emailModal';
        modal.className = 'email-modal';
        modal.innerHTML = `
            <div class="email-modal-content">
                <h3>üìß –°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ —Å –Ω–∞—Å</h3>
                <div class="email-address-display" id="emailDisplay">historyaddressbg@gmail.com</div>
                <div class="email-modal-buttons">
                    <button class="btn-copy" onclick="copyEmail()">
                        <span id="copyText">üìã –ö–æ–ø–∏—Ä–∞–π Email</span>
                    </button>
                    <button class="btn-close" onclick="closeEmailModal()">‚úï –ó–∞—Ç–≤–æ—Ä–∏</button>
                </div>
                <p>–ú–æ–∂–µ—Ç–µ –¥–∞ –Ω–∏ –ø–∏—à–µ—Ç–µ –∑–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏–ª–∏ –ø–æ–¥–∫—Ä–µ–ø–∞</p>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeEmailModal();
            }
        });
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeEmailModal() {
    var modal = document.getElementById('emailModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

function copyEmail() {
    var email = 'historyaddressbg@gmail.com';
    navigator.clipboard.writeText(email).then(function() {
        var btn = document.querySelector('.btn-copy');
        var text = document.getElementById('copyText');
        
        btn.classList.add('copied');
        text.textContent = '‚úì –ö–æ–ø–∏—Ä–∞–Ω–æ!';
        
        setTimeout(function() {
            btn.classList.remove('copied');
            text.textContent = 'üìã –ö–æ–ø–∏—Ä–∞–π Email';
        }, 2000);
    }).catch(function(err) {
        alert('Email: ' + email);
    });
}

// Close modal on ESC key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeEmailModal();
    }
});
</script>
<body>
  <header class="site-header">
    <a class="logo-link" href="index.html">
        <img src="assets/img/HistAdrLogo.png" alt="–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞" class="header-logo">
        <span class="logo-text">–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</span>
    </a>
    <nav class="nav">
        <a href="index.html">–ù–∞—á–∞–ª–æ</a>
        <a href="map.html">–ö–∞—Ä—Ç–∞</a>
        <a href="addresses.html">–î–æ–º–æ–≤–µ</a>
        <a href="calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä</a>
        <a href="about.html">–ó–∞ –ù–∞—Å</a>
    </nav>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode"></button>
</header>

    <main class="container">
        <div id="detail" class="detail">
            <p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>
        </div>
    </main>

    <footer class="site-footer">
        <p>¬© <span id="year"></span> –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</p>
        <div class="footer-social">
            <a href="https://instagram.com/historyaddress.bg" target="_blank" rel="noopener noreferrer" class="social-link">
                üì∑ Instagram
            </a>
           <a href="mailto:historyaddressbg@gmail.com" class="social-link" onclick="handleEmailClick(event)">
    üìß Email
</a>
        </div>
        <p class="footer-links">
            <a href="privacy.html">–ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</a> | 
            <a href="terms.html">–£—Å–ª–æ–≤–∏—è</a> | 
            <a href="copyright.html">–ê–≤—Ç–æ—Ä—Å–∫–∏ –ø—Ä–∞–≤–∞</a>
        </p>
    </footer>

    <div id="lightbox" class="lightbox-backdrop" style="display:none;">
        <div class="lightbox-content">
            <button id="closeLightbox" class="close-btn" aria-label="Close" title="Close">√ó</button>
            <img id="lightboxImage" src="" alt="Enlarged image" style="max-width: 90vw; max-height: 90vh;">
        </div>
    </div>

    <script>
    (function() {
        function q(name) {
            var url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var slug = q('slug');
        var root = document.getElementById('detail');
        var ph = 'assets/img/placeholder.svg';

        if (!slug) {
            root.innerHTML = '<p>–ù–µ –µ –ø–æ—Å–æ—á–µ–Ω –∞–¥—Ä–µ—Å.</p>';
            return;
        }
        
        var apiBase = window.location.protocol === 'file:' ? 'http://localhost:3000' : window.location.origin;
        var API_URL = apiBase + '/api/homes/' + encodeURIComponent(slug);

        fetch(API_URL)
            .then(function(res){
                if (!res.ok) {
                    if (res.status === 404) throw new Error('–ê–¥—Ä–µ—Å—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω');
                    throw new Error('–°—ä—Ä–≤—ä—Ä–Ω–∞ –≥—Ä–µ—à–∫–∞');
                }
                return res.json();
            })
            .then(function(person){
                renderHome(person);
                updateMetaTags(person);
                addStructuredData(person);
            })
            .catch(function(err){
                console.error('Error loading home:', err);
                root.innerHTML = '<p>–ì—Ä–µ—à–∫–∞: ' + err.message + '. –ú–æ–ª—è, –ø—Ä–æ–≤–µ—Ä–µ—Ç–µ –≤—Ä—ä–∑–∫–∞—Ç–∞.</p>';
            });

        function updateMetaTags(person) {
            var pageUrl = 'https://historyaddress.bg/address.html?slug=' + encodeURIComponent(slug);
            var description = person.biography ? person.biography.substring(0, 155) : '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∞–¥—Ä–µ—Å: ' + person.address;
            var imageUrl = (person.images && person.images[0] && person.images[0].path) 
                ? 'https://historyaddress.bg/' + person.images[0].path 
                : 'https://historyaddress.bg/assets/img/HistAdrLogo.png';

            // Title –Ω–∞ –ë—ä–ª–≥–∞—Ä—Å–∫–∏
            document.title = person.name + ' ‚Äî –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞';

            var metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) metaDesc.setAttribute('content', description);

            var canonical = document.querySelector('link[rel="canonical"]');
            if (canonical) canonical.setAttribute('href', pageUrl);
            
            var ogUrl = document.querySelector('meta[property="og:url"]');
            if (ogUrl) ogUrl.setAttribute('content', pageUrl);
            
            var ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) ogTitle.setAttribute('content', person.name);
            
            var ogDesc = document.querySelector('meta[property="og:description"]');
            if (ogDesc) ogDesc.setAttribute('content', description);
            
            var ogImage = document.querySelector('meta[property="og:image"]');
            if (ogImage) ogImage.setAttribute('content', imageUrl);

            var twitterUrl = document.querySelector('meta[property="twitter:url"]');
            if (twitterUrl) twitterUrl.setAttribute('content', pageUrl);
            
            var twitterTitle = document.querySelector('meta[property="twitter:title"]');
            if (twitterTitle) twitterTitle.setAttribute('content', person.name);
            
            var twitterDesc = document.querySelector('meta[property="twitter:description"]');
            if (twitterDesc) twitterDesc.setAttribute('content', description);
            
            var twitterImage = document.querySelector('meta[property="twitter:image"]');
            if (twitterImage) twitterImage.setAttribute('content', imageUrl);
        }

        function addStructuredData(person) {
            var script = document.createElement('script');
            script.type = 'application/ld+json';
            var structuredData = {
                "@context": "https://schema.org",
                "@type": "Place",
                "name": person.name,
                "description": person.biography || '',
                "address": {
                    "@type": "PostalAddress",
                    "streetAddress": person.address || '',
                    "addressCountry": "BG"
                }
            };
            if (person.coordinates && person.coordinates.lat && person.coordinates.lng) {
                structuredData.geo = {
                    "@type": "GeoCoordinates",
                    "latitude": person.coordinates.lat,
                    "longitude": person.coordinates.lng
                };
            }
            if (person.images && person.images[0] && person.images[0].path) {
                structuredData.image = 'https://historyaddress.bg/' + person.images[0].path;
            }
            script.textContent = JSON.stringify(structuredData);
            document.head.appendChild(script);
        }
        
        function renderHome(person) {
            // Title –Ω–∞ –ë—ä–ª–≥–∞—Ä—Å–∫–∏
            document.title = person.name + ' ‚Äî –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞';
            
            var portraitHtml = '';
            if (person.portrait_url) {
                portraitHtml = '<div class="portrait-container slide-in-left"><img class="portrait-image" alt="–ü–æ—Ä—Ç—Ä–µ—Ç –Ω–∞ ' + person.name + '" src="' + person.portrait_url + '" loading="lazy"></div>';
            }
            
            var gallery = (person.images||[]);
            var hero = gallery[0] || null;
            var imgHtml = hero ? 
                '<img class="zoomable-image" alt="'+((hero && hero.alt) || ('–§–∞—Å–∞–¥–∞ –Ω–∞ '+person.name))+'" loading="lazy" src="'+((hero && hero.path) || ph)+'" onerror="this.onerror=null;this.src=\''+ph+'\';">' : '';

            var galleryHtml = '';
            if ((gallery||[]).length > 1) {
                galleryHtml = '<div class="gallery slide-up">' + gallery.slice(1).map(function(i){ 
                    var s = (i && i.path) || ph; 
                    var a = (i && i.alt) || ('–§–∞—Å–∞–¥–∞ –Ω–∞ '+person.name); 
                    return '<img class="zoomable-image" alt="'+a+'" loading="lazy" src="'+s+'" onerror="this.onerror=null;this.src=\''+ph+'\';">'; 
                }).join('') + '</div>';
            }
            
            var tags = (person.tags||[]).map(function(t){ return '<a class="tag" href="addresses.html?tag='+encodeURIComponent(t)+'">'+t+'</a>'; }).join(' ');
            var mapLink = (person.coordinates && person.coordinates.lat && person.coordinates.lng) ? ('map.html?slug=' + encodeURIComponent(person.slug||person.id)) : '';
            
            var sources = (person.sources||[]).map(function(s){
                var isUrl = /^https?:\/\//i.test(s.trim());
                return isUrl ? '<li><a href="'+s.trim()+'" rel="noopener" target="_blank">'+s.trim()+'</a></li>' : '<li>'+s.trim()+'</li>';
            }).join('');
            
            root.innerHTML =
                (imgHtml ? ('<p class="fade-in">'+imgHtml+'</p>') : '') +
                galleryHtml +
                '<h1 class="gradient-text slide-up">'+person.name+'</h1>'+
                '<p class="meta slide-up">–ê–¥—Ä–µ—Å: '+(person.address||'')+(mapLink ? ' ‚Äî <a href="'+mapLink+'">–í–∏–∂ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞</a>' : '')+'</p>'+
                '<div class="content-split">'+
                    portraitHtml +
                    '<div class="biography-text slide-up">'+
                        '<p>'+ (person.biography||'') +'</p>'+
                    '</div>'+
                '</div>'+
                (person.photo_date ? ('<p class="meta slide-up">–î–∞—Ç–∞ –Ω–∞ —Å–Ω–∏–º–∫–∞—Ç–∞: '+person.photo_date+'</p>') : '')+
                (sources ? ('<h3 class="slide-up">–ò–∑—Ç–æ—á–Ω–∏—Ü–∏</h3><ul class="slide-up">'+sources+'</ul>') : '')+
                (tags ? ('<p class="tags slide-up">'+tags+'</p>') : '');
            
            document.getElementById('year').textContent = new Date().getFullYear();
        }
        

        var lightbox = document.getElementById('lightbox');
        var lightboxImage = document.getElementById('lightboxImage');
        var closeLightbox = document.getElementById('closeLightbox');
        var detailContainer = document.getElementById('detail');

        function openLightbox(src) {
            lightboxImage.src = src;
            lightbox.style.display = 'flex';
            document.body.style.overflow = 'hidden'; 
        }

        function closeLightboxModal() {
            lightbox.style.display = 'none';
            document.body.style.overflow = '';
        }

        detailContainer.addEventListener('click', function(e) {
            var target = e.target;
            if (target.classList.contains('zoomable-image')) {
                var imgSrc = target.getAttribute('src');
                if (imgSrc && imgSrc.indexOf(ph) === -1) { 
                    openLightbox(imgSrc);
                }
            }
        });

        closeLightbox.addEventListener('click', closeLightboxModal);
        lightbox.addEventListener('click', function(e) {
            if (e.target.id === 'lightbox') closeLightboxModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && lightbox.style.display === 'flex') closeLightboxModal();
        });
    })();
    </script>
</body>
</html>
