<!doctype html>
<html lang="bg" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/assets/img/Historyaddress.bg2.png">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä - –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</title>
    <meta name="description" content="–í–∏–∂—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏ –¥–Ω–∏ –∏ –≥–æ–¥–∏—à–Ω–∏–Ω–∏ –æ—Ç –∂–∏–≤–æ—Ç–∞ –Ω–∞ –∑–Ω–∞—á–∏–º–∏ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏.">
    <script>
        (function() {
            try {
                var stored = localStorage.getItem('theme-preference');
                if (stored === 'system') stored = 'dark';
                var theme = (stored === 'dark' || stored === 'light') ? stored : 'dark';
                document.documentElement.setAttribute('data-theme', theme);
            } catch(e) {}
        })();
    </script>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script defer src="assets/js/theme.js"></script>
    <script defer src="assets/js/transitions.js"></script>
<style>
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    .calendar-nav {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
    .calendar-nav button {
        min-width: 40px;
        padding: 0.6rem;
    }
    .calendar-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--fg);
        min-width: 140px;
        text-align: center;
    }
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px; /* –ù–∞–º–∞–ª–µ–Ω–æ –∑–∞ –ø–æ–≤–µ—á–µ –º—è—Å—Ç–æ */
        margin-bottom: 2rem;
        width: 100%;
    }
    .calendar-day-header {
        text-align: center;
        padding: 0.5rem 0;
        font-weight: 700;
        color: var(--muted);
        font-size: 0.75rem;
        text-transform: uppercase;
    }
    .calendar-day {
        aspect-ratio: 1;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 4px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —á–∏—Å–ª–æ—Ç–æ */
        position: relative;
        cursor: default;
        transition: all 0.2s ease;
        min-height: 50px; /* –ü–æ-–º–∞–ª–∫–æ –∑–∞ –º–∞–ª–∫–∏ –µ–∫—Ä–∞–Ω–∏ */
    }
    .calendar-day.other-month {
        opacity: 0.2;
    }
    .calendar-day.today {
        border: 2px solid var(--accent-strong);
        background: rgba(205, 133, 63, 0.05);
    }
    .calendar-day.has-events {
        cursor: pointer;
        background: rgba(205, 133, 63, 0.15);
    }
    .calendar-day.has-events:active {
        transform: scale(0.95);
    }
    
    /* –ü–û-–ì–û–õ–ï–ú–ò –ß–ò–°–õ–ê */
    .calendar-day-number {
        font-weight: 800;
        font-size: 1.3rem; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –æ—Ç 1.1 */
        color: var(--fg);
        line-height: 1;
    }

    .calendar-events-indicator {
        display: flex;
        gap: 3px;
        justify-content: center;
        position: absolute;
        bottom: 6px;
    }
    .event-dot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
    }
    .event-dot.birth { background: #4CAF50; }
    .event-dot.death { background: #ff4d4d; } /* –ü–æ-—è—Ä—ä–∫ —Ü–≤—è—Ç –∑–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç */

    /* –°–ü–ï–¶–ò–ê–õ–ù–ò –ö–û–†–ï–ö–¶–ò–ò –ó–ê –¢–ï–õ–ï–§–û–ù */
    @media (max-width: 480px) {
        .container {
            padding-left: 8px;
            padding-right: 8px;
        }
        .calendar-grid {
            gap: 4px;
        }
        .calendar-day-number {
            font-size: 1.15rem; /* –û—Ç–Ω–æ–≤–æ –≥–æ–ª—è–º–æ, –Ω–æ —Å—ä–æ–±—Ä–∞–∑–µ–Ω–æ —Å —Ç–µ—Å–Ω–∏—è –µ–∫—Ä–∞–Ω */
        }
        .calendar-day {
            border-radius: 6px;
            min-height: 45px;
        }
        .calendar-title {
            font-size: 1.1rem;
        }
        .calendar-day-header {
            font-size: 0.65rem;
        }
    }

    /* –°–¢–ò–õ –ó–ê –ö–ê–†–¢–ò–¢–ï –°–™–° –°–™–ë–ò–¢–ò–Ø */
    .events-list { margin-top: 1.5rem; }
    .event-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        gap: 1rem;
        align-items: center;
        text-decoration: none;
        color: inherit;
    }
    .event-icon { font-size: 1.5rem; }
    .event-name { font-weight: 700; color: var(--fg); }
    .event-years { color: var(--accent-soft); font-size: 0.85rem; font-weight: 600; }
</style>
    <!-- Add this in the <head> section, after the other script tags -->
<script defer src="assets/js/calendar-popup.js"></script>
</head>
<body>
    <header class="site-header">
        <a class="logo-link" href="index.html">
            <img src="assets/img/HistAdrLogo.png" alt="–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞" class="header-logo">
            <span class="logo-text">–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</span>
        </a>
        <nav class="nav">
            <a href="index.html">–ù–∞—á–∞–ª–æ</a>
            <a href="map.html">–ö–∞—Ä—Ç–∞</a>
            <a href="addresses.html">–î–æ–º–æ–≤–µ</a>
            <a href="calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä</a>
            <a href="about.html">–ó–∞ –ù–∞—Å</a>
        </nav>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode"></button>
    </header>

    <main class="container">
        <h1 class="page-title gradient-text">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä –Ω–∞ —Å—ä–±–∏—Ç–∏—è—Ç–∞</h1>
        
        <div class="calendar-header">
            <div class="calendar-nav">
                <button id="prevMonth" class="theme-toggle">‚óÄ</button>
                <span class="calendar-title" id="monthYear">Loading...</span>
                <button id="nextMonth" class="theme-toggle">‚ñ∂</button>
            </div>
            <button id="todayBtn" class="theme-toggle">–î–Ω–µ—Å</button>
        </div>

        <div class="calendar-grid" id="calendarGrid"></div>

        <div class="events-list" id="eventsList"></div>
    </main>

    <footer class="site-footer">
        <p>¬© <span id="year"></span> –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</p>
        <div class="footer-social">
            <a href="https://instagram.com/historyaddress.bg" target="_blank" rel="noopener noreferrer" class="social-link">
                üì∑ Instagram
            </a>
            <a href="mailto:historyaddressbg@gmail.com" class="social-link">
                üìß Email
            </a>
        </div>
        <p class="footer-links">
            <a href="privacy.html">–ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</a> | 
            <a href="terms.html">–£—Å–ª–æ–≤–∏—è</a> | 
            <a href="copyright.html">–ê–≤—Ç–æ—Ä—Å–∫–∏ –ø—Ä–∞–≤–∞</a>
        </p>
    </footer>

    <script>
    (function() {
        var apiBase = window.location.protocol === 'file:' ? 'http://localhost:3000' : window.location.origin;
        var currentDate = new Date();
        var selectedDate = null;
        var eventsData = {};
        
        var monthNames = ['–Ø–Ω—É–∞—Ä–∏', '–§–µ–≤—Ä—É–∞—Ä–∏', '–ú–∞—Ä—Ç', '–ê–ø—Ä–∏–ª', '–ú–∞–π', '–Æ–Ω–∏', 
                          '–Æ–ª–∏', '–ê–≤–≥—É—Å—Ç', '–°–µ–ø—Ç–µ–º–≤—Ä–∏', '–û–∫—Ç–æ–º–≤—Ä–∏', '–ù–æ–µ–º–≤—Ä–∏', '–î–µ–∫–µ–º–≤—Ä–∏'];
        var dayNames = ['–ù–¥', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
        
        function loadEvents() {
            var month = currentDate.getMonth() + 1;
            var year = currentDate.getFullYear();
            
            fetch(apiBase + '/api/calendar?month=' + month + '&year=' + year)
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    eventsData = data;
                    renderCalendar();
                    if (selectedDate) {
                        showEventsForDate(selectedDate);
                    }
                })
                .catch(function(err) {
                    console.error('Error loading events:', err);
                });
        }
        
        function renderCalendar() {
            var grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Day headers
            dayNames.forEach(function(day) {
                var header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            var year = currentDate.getFullYear();
            var month = currentDate.getMonth();
            var firstDay = new Date(year, month, 1).getDay();
            var daysInMonth = new Date(year, month + 1, 0).getDate();
            var daysInPrevMonth = new Date(year, month, 0).getDate();
            
            var today = new Date();
            var isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
            
            // Previous month days
            for (var i = firstDay - 1; i >= 0; i--) {
                var day = daysInPrevMonth - i;
                var cell = createDayCell(day, true, false);
                grid.appendChild(cell);
            }
            
            // Current month days
            for (var day = 1; day <= daysInMonth; day++) {
                var isToday = isCurrentMonth && day === today.getDate();
                var cell = createDayCell(day, false, isToday);
                grid.appendChild(cell);
            }
            
            // Next month days
            var totalCells = grid.children.length - 7; // subtract headers
            var remainingCells = (Math.ceil(totalCells / 7) * 7) - totalCells;
            for (var day = 1; day <= remainingCells; day++) {
                var cell = createDayCell(day, true, false);
                grid.appendChild(cell);
            }
            
            document.getElementById('monthYear').textContent = monthNames[month] + ' ' + year;
        }
        
        function createDayCell(day, otherMonth, isToday) {
            var cell = document.createElement('div');
            cell.className = 'calendar-day';
            if (otherMonth) cell.className += ' other-month';
            if (isToday) cell.className += ' today';
            
            var dateKey = formatDateKey(currentDate.getFullYear(), currentDate.getMonth() + (otherMonth ? (day > 15 ? -1 : 1) : 0), day);
            var events = eventsData[dateKey] || [];
            
            if (events.length > 0 && !otherMonth) {
                cell.className += ' has-events';
                cell.onclick = function() {
                    selectedDate = dateKey;
                    showEventsForDate(dateKey);
                };
            }
            
            var number = document.createElement('div');
            number.className = 'calendar-day-number';
            number.textContent = day;
            cell.appendChild(number);
            
            if (events.length > 0) {
                var indicator = document.createElement('div');
                indicator.className = 'calendar-events-indicator';
                events.forEach(function(event) {
                    var dot = document.createElement('div');
                    dot.className = 'event-dot ' + event.type;
                    indicator.appendChild(dot);
                });
                cell.appendChild(indicator);
            }
            
            return cell;
        }
        
        function formatDateKey(year, month, day) {
            return String(month + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
        }
        
        function showEventsForDate(dateKey) {
            var events = eventsData[dateKey] || [];
            var listEl = document.getElementById('eventsList');
            
            if (events.length === 0) {
                listEl.innerHTML = '';
                return;
            }
            
            var parts = dateKey.split('-');
            var displayDate = parts[1] + ' ' + monthNames[parseInt(parts[0]) - 1];
            
            var html = '<h2 style="margin-bottom: 1rem; color: var(--fg);">–°—ä–±–∏—Ç–∏—è –Ω–∞ ' + displayDate + '</h2>';
            
            events.forEach(function(event) {
                var icon = event.type === 'birth' ? 'üéÇ' : 'üïØÔ∏è';
                var typeText = event.type === 'birth' ? '–†–æ–¥–µ–Ω' : '–ü–æ—á–∏–Ω–∞–ª';
                var years = event.years_ago;
                var yearsText = years === 1 ? '–≥–æ–¥–∏–Ω–∞' : '–≥–æ–¥–∏–Ω–∏';
                
                html += '<a href="address.html?slug=' + encodeURIComponent(event.slug) + '" class="event-card">';
                html += '<div class="event-icon">' + icon + '</div>';
                html += '<div class="event-content">';
                html += '<div class="event-name">' + event.name + '</div>';
                html += '<div class="event-date">' + typeText + ' –Ω–∞ ' + event.full_date + '</div>';
                html += '<div class="event-years">–ü—Ä–µ–¥–∏ ' + years + ' ' + yearsText + '</div>';
                html += '</div></a>';
            });
            
            listEl.innerHTML = html;
            listEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        document.getElementById('prevMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            selectedDate = null;
            document.getElementById('eventsList').innerHTML = '';
            loadEvents();
        });
        
        document.getElementById('nextMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            selectedDate = null;
            document.getElementById('eventsList').innerHTML = '';
            loadEvents();
        });
        
        document.getElementById('todayBtn').addEventListener('click', function() {
            currentDate = new Date();
            selectedDate = null;
            document.getElementById('eventsList').innerHTML = '';
            loadEvents();
        });
        
        document.getElementById('year').textContent = new Date().getFullYear();
        loadEvents();
    })();
    </script>
</body>
</html>
