<!doctype html>
<html lang="bg" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/assets/img/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/img/favicon.svg" />
    <link rel="shortcut icon" href="/assets/img/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png" />
    <link rel="manifest" href="/assets/img/site.webmanifest" />

    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä - –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</title>
    <meta name="description" content="–í–∏–∂—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏ –¥–Ω–∏ –∏ –≥–æ–¥–∏—à–Ω–∏–Ω–∏ –æ—Ç –∂–∏–≤–æ—Ç–∞ –Ω–∞ –∑–Ω–∞—á–∏–º–∏ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏.">
    <script>
        (function() {
            try {
                var stored = localStorage.getItem('theme-preference');
                var theme = (stored === 'dark' || stored === 'light') ? stored : 'dark';
                document.documentElement.setAttribute('data-theme', theme);
            } catch(e) {}
        })();
    </script>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script defer src="assets/js/theme.js"></script>
    <script defer src="assets/js/transitions.js"></script>
    <style>
        /* OVERRIDE .container padding on mobile - styles.css adds huge padding that breaks mobile */
        @media (max-width: 768px) {
            .container {
                padding: 1rem 0.5rem !important;
            }
        }
        @media (max-width: 480px) {
            .container {
                padding: 0.8rem 0.3rem !important;
            }
        }

        /* LEGEND - compact, just 2 badges */
        .calendar-legend {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--card);
            border-radius: 10px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
        }
        .legend-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .legend-badge.birth {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        .legend-badge.death {
            background: rgba(158, 158, 158, 0.2);
            color: #9E9E9E;
        }

        /* hint below calendar */
        .calendar-hint {
            text-align: center;
            color: var(--muted);
            font-size: 0.75rem;
            margin-top: 0.5rem;
            opacity: 0.6;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        .calendar-nav {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }
        .calendar-nav button {
            min-width: 44px;
            padding: 0.6rem 0.9rem;
        }
        .calendar-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--fg);
        }
        
        /* CALENDAR GRID - AGGRESSIVE MOBILE FIXES */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 0.5rem;
            width: 100%;
        }
        .calendar-day-header {
            text-align: center;
            padding: 0.8rem 0.3rem;
            font-weight: 700;
            color: var(--muted);
            font-size: 0.85rem;
            text-transform: uppercase;
        }
        
        /* DAY CELLS */
        .calendar-day {
            aspect-ratio: 1;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 0.4rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: default;
            transition: all 0.3s ease;
            min-height: 75px;
        }
        
        .calendar-day.other-month {
            opacity: 0.2;
            background: transparent;
        }
        
        .calendar-day.today {
            border: 2px solid var(--accent-strong);
            box-shadow: 0 0 15px rgba(205, 133, 63, 0.3);
            background: rgba(205, 133, 63, 0.08);
        }
        
        .calendar-day.has-events {
            cursor: pointer;
            border-color: var(--accent-strong);
            background: linear-gradient(135deg, rgba(205, 133, 63, 0.12) 0%, rgba(205, 133, 63, 0.04) 100%);
        }
        
        .calendar-day.has-events:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 6px 20px rgba(205, 133, 63, 0.25);
            border-color: var(--accent-soft);
            background: linear-gradient(135deg, rgba(205, 133, 63, 0.2) 0%, rgba(205, 133, 63, 0.1) 100%);
        }
        
        /* DATE NUMBER */
        .calendar-day-number {
            font-weight: 800;
            font-size: 1.6rem;
            color: var(--fg);
            line-height: 1;
            margin-bottom: 0.3rem;
        }
        
        .calendar-day.has-events .calendar-day-number {
            color: var(--accent-strong);
        }
        
        /* EVENT BADGES */
        .calendar-events-badges {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .event-badge {
            font-size: 1.2rem;
            line-height: 1;
        }
        
        .event-badge.birth {
            filter: drop-shadow(0 1px 3px rgba(76, 175, 80, 0.4));
        }
        
        .event-badge.death {
            filter: drop-shadow(0 1px 3px rgba(158, 158, 158, 0.4));
        }
        
        /* Event count badge */
        .event-count {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--accent-strong);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }

        .calendar-day.highlighted {
            animation: pulse 1.5s ease-in-out 3;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(205, 133, 63, 0.6); }
            50% { box-shadow: 0 0 0 12px rgba(205, 133, 63, 0); }
        }

        .events-list {
            margin-top: 1.5rem;
        }
        .event-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.2rem;
            margin-bottom: 0.8rem;
            display: flex;
            gap: 0.9rem;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }
        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-soft);
            border-color: var(--accent-strong);
        }
        .event-icon {
            font-size: 2.2rem;
            flex-shrink: 0;
        }
        .event-content {
            flex: 1;
        }
        .event-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--fg);
            margin-bottom: 0.2rem;
        }
        .event-date {
            color: var(--muted);
            font-size: 0.85rem;
        }
        .event-years {
            color: var(--accent-soft);
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.2rem;
        }

        /* SEARCH */
        .search-result-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.9rem;
            margin-bottom: 0.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .search-result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
            background: rgba(205, 133, 63, 0.08);
            border-color: var(--accent-strong);
        }
        .search-result-name {
            font-weight: 700;
            color: var(--fg);
            margin-bottom: 0.2rem;
        }
        .search-result-dates {
            font-size: 0.8rem;
            color: var(--muted);
        }
        .search-result-badge {
            background: rgba(205, 133, 63, 0.18);
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-strong);
        }

        /* === MOBILE HOTFIX === */
        @media (max-width: 768px) {
            .calendar-grid {
                gap: 3px;
            }
            .calendar-day {
                min-height: 50px;
                padding: 0.2rem;
                border-width: 1px;
            }
            .calendar-day-number {
                font-size: 1.1rem;
                margin-bottom: 0.15rem;
            }
            .event-badge {
                font-size: 0.9rem;
            }
            .event-count {
                width: 16px;
                height: 16px;
                font-size: 0.6rem;
                top: 2px;
                right: 2px;
            }
            .calendar-day-header {
                padding: 0.5rem 0.2rem;
                font-size: 0.7rem;
            }
            .calendar-nav button {
                padding: 0.5rem 0.8rem;
                font-size: 0.9rem;
            }
            .calendar-title {
                font-size: 1.1rem;
            }
            .calendar-legend {
                padding: 0.6rem;
                gap: 0.7rem;
            }
            .legend-item {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .calendar-grid {
                gap: 2px;
            }
            .calendar-day {
                min-height: 42px;
                padding: 0.15rem;
                border-radius: 6px;
            }
            .calendar-day-number {
                font-size: 0.95rem;
                margin-bottom: 0.1rem;
            }
            .event-badge {
                font-size: 0.75rem;
            }
            .event-count {
                width: 14px;
                height: 14px;
                font-size: 0.55rem;
                top: 1px;
                right: 1px;
            }
            .calendar-day-header {
                padding: 0.4rem 0.1rem;
                font-size: 0.65rem;
            }
            .calendar-legend {
                padding: 0.5rem;
                gap: 0.5rem;
            }
            .legend-item {
                font-size: 0.75rem;
            }
            .legend-badge {
                font-size: 0.7rem;
                padding: 0.15rem 0.4rem;
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <a class="logo-link" href="index.html">
            <img src="assets/img/HistAdrLogo.png" alt="–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞" class="header-logo">
            <span class="logo-text">–ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</span>
        </a>
        <nav class="nav">
            <a href="index.html">–ù–∞—á–∞–ª–æ</a>
            <a href="map.html">–ö–∞—Ä—Ç–∞</a>
            <a href="addresses.html">–î–æ–º–æ–≤–µ</a>
            <a href="calendar.html">–ö–∞–ª–µ–Ω–¥–∞—Ä</a>
            <a href="about.html">–ó–∞ –ù–∞—Å</a>
        </nav>
        <button id="theme-toggle" aria-label="Toggle dark mode">
            <span class="theme-icon sun">‚òÄÔ∏è</span>
            <span class="theme-icon moon">üåô</span>
        </button>
    </header>

    <main class="container">
        <h1 class="page-title gradient-text">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä –Ω–∞ —Å—ä–±–∏—Ç–∏—è—Ç–∞</h1>
        
        <!-- LEGEND - compact, just badges -->
        <div class="calendar-legend">
            <div class="legend-item">
                <span style="font-size: 1.2rem;">üéÇ</span>
                <span class="legend-badge birth">–†–æ–∂–¥–µ–Ω –¥–µ–Ω</span>
            </div>
            <div class="legend-item">
                <span style="font-size: 1.2rem;">üïØÔ∏è</span>
                <span class="legend-badge death">–ì–æ–¥–∏—à–Ω–∏–Ω–∞</span>
            </div>
        </div>
        
        <div style="margin-bottom: 1.2rem;">
            <input 
                type="text" 
                id="searchInput" 
                class="input" 
                placeholder="üîç –¢—ä—Ä—Å–∏ –ø–æ –∏–º–µ –Ω–∞ –ª–∏—á–Ω–æ—Å—Ç..." 
                style="width: 100%; max-width: 500px; font-size: 0.95rem;"
            >
            <div id="searchResults" style="margin-top: 0.4rem;"></div>
        </div>
        
        <div class="calendar-header">
            <div class="calendar-nav">
                <button id="prevMonth" class="theme-toggle">‚óÄ</button>
                <span class="calendar-title" id="monthYear">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span>
                <button id="nextMonth" class="theme-toggle">‚ñ∂</button>
            </div>
            <button id="todayBtn" class="theme-toggle">–î–Ω–µ—Å</button>
        </div>

        <div class="calendar-grid" id="calendarGrid"></div>
        
        <!-- Hint below calendar -->
        <div class="calendar-hint">üí° –ö–ª–∏–∫–Ω–µ—Ç–µ –≤—ä—Ä—Ö—É –¥–∞—Ç–∏—Ç–µ —Å—ä—Å —Å—ä–±–∏—Ç–∏—è</div>
        
        <div class="events-list" id="eventsList"></div>
    </main>

    <footer class="site-footer">
        <div class="footer-inner" style="max-width: 900px; margin: 0 auto; text-align: center;">
            <p>¬© <span id="year"></span> –ê–¥—Ä–µ—Å—ä—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</p>
            <p class="footer-links" style="margin: 1rem 0;">
                <a href="privacy.html">–ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</a> | 
                <a href="terms.html">–£—Å–ª–æ–≤–∏—è</a> | 
                <a href="copyright.html">–ê–≤—Ç–æ—Ä—Å–∫–∏ –ø—Ä–∞–≤–∞</a>
            </p>
        </div>
    </footer>

<script>
(function() {
    var apiBase = window.location.protocol === 'file:' ? 'http://localhost:3000' : window.location.origin;
    
    var savedState = null;
    try {
        var saved = sessionStorage.getItem('calendar-state');
        if (saved) savedState = JSON.parse(saved);
    } catch(e) {}
    
    var currentDate = savedState && savedState.month && savedState.year 
        ? new Date(savedState.year, savedState.month - 1, 1)
        : new Date();
    var selectedDate = savedState ? savedState.selectedDate : null;
    var eventsData = {};
    var allPeopleData = [];
    var searchTimeout;
    
    var monthNames = ['–Ø–Ω—É–∞—Ä–∏', '–§–µ–≤—Ä—É–∞—Ä–∏', '–ú–∞—Ä—Ç', '–ê–ø—Ä–∏–ª', '–ú–∞–π', '–Æ–Ω–∏', '–Æ–ª–∏', '–ê–≤–≥—É—Å—Ç', '–°–µ–ø—Ç–µ–º–≤—Ä–∏', '–û–∫—Ç–æ–º–≤—Ä–∏', '–ù–æ–µ–º–≤—Ä–∏', '–î–µ–∫–µ–º–≤—Ä–∏'];
    var dayNames = ['–ù–¥', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
    
    function saveCalendarState() {
        try {
            sessionStorage.setItem('calendar-state', JSON.stringify({
                month: currentDate.getMonth() + 1,
                year: currentDate.getFullYear(),
                selectedDate: selectedDate
            }));
        } catch(e) {}
    }
    
    function loadAllPeople() {
        fetch(apiBase + '/api/calendar/all')
            .then(function(res) { return res.json(); })
            .then(function(data) { allPeopleData = data; })
            .catch(function(err) { console.error('Error loading people:', err); });
    }
    
    document.getElementById('searchInput').addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        var query = e.target.value.trim().toLowerCase();
        if (query.length < 2) {
            document.getElementById('searchResults').innerHTML = '';
            return;
        }
        searchTimeout = setTimeout(function() { performSearch(query); }, 300);
    });
    
    function performSearch(query) {
        var words = query.split(/\s+/);
        var results = allPeopleData.filter(function(person) {
            var nameLower = person.name.toLowerCase();
            return words.every(function(word) { return nameLower.includes(word); });
        });
        displaySearchResults(results.slice(0, 5));
    }
    
    function displaySearchResults(results) {
        var container = document.getElementById('searchResults');
        if (results.length === 0) {
            container.innerHTML = '<div style="color: var(--muted); font-size: 0.85rem;">–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</div>';
            return;
        }
        
        var html = '';
        results.forEach(function(person) {
            var dates = [];
            if (person.birth_date) dates.push('üéÇ ' + person.birth_date);
            if (person.death_date) dates.push('üïØÔ∏è ' + person.death_date);
            var datesText = dates.join(' ‚Ä¢ ');
            
            var count = (person.birth_date ? 1 : 0) + (person.death_date ? 1 : 0);
            var badge = count + ' ' + (count === 1 ? '–¥–∞—Ç–∞' : '–¥–∞—Ç–∏');
            
            html += '<div class="search-result-item" onclick="showPersonDates(\'' + (person.birth_date || '') + '\', \'' + (person.death_date || '') + '\', \'' + person.name.replace(/'/g, "\\'") + '\')">';
            html += '<div>';
            html += '<div class="search-result-name">' + person.name + '</div>';
            html += '<div class="search-result-dates">' + datesText + '</div>';
            html += '</div>';
            html += '<div class="search-result-badge">' + badge + '</div>';
            html += '</div>';
        });
        container.innerHTML = html;
    }

    window.showPersonDates = function(birthDate, deathDate, personName) {
        var container = document.getElementById('searchResults');
        var html = '<div style="background: var(--card); border: 2px solid var(--accent-strong); border-radius: 10px; padding: 0.9rem; margin-bottom: 0.4rem;">';
        html += '<div style="font-weight: 700; margin-bottom: 0.6rem; font-size: 1rem;">' + personName + '</div>';
        
        if (birthDate) {
            html += '<div class="search-result-item" style="margin-bottom: 0.4rem;" onclick="jumpToDate(\'' + birthDate + '\', \'' + personName.replace(/'/g, "\\'") + '\')">';
            html += '<div><div class="search-result-name">üéÇ –†–æ–∂–¥–µ–Ω –¥–µ–Ω</div>';
            html += '<div class="search-result-dates">' + birthDate + '</div></div>';
            html += '<div class="search-result-badge">–í–∏–∂</div></div>';
        }
        
        if (deathDate) {
            html += '<div class="search-result-item" style="margin-bottom: 0;" onclick="jumpToDate(\'' + deathDate + '\', \'' + personName.replace(/'/g, "\\'") + '\')">';
            html += '<div><div class="search-result-name">üïØÔ∏è –î–∞—Ç–∞ –Ω–∞ —Å–º—ä—Ä—Ç</div>';
            html += '<div class="search-result-dates">' + deathDate + '</div></div>';
            html += '<div class="search-result-badge">–í–∏–∂</div></div>';
        }
        
        html += '<button onclick="performSearch(document.getElementById(\'searchInput\').value)" style="margin-top: 0.6rem; padding: 0.45rem 0.9rem; background: var(--muted); border: none; border-radius: 7px; cursor: pointer; width: 100%; color: var(--fg); font-weight: 600; font-size: 0.85rem;">‚Üê –ù–∞–∑–∞–¥</button>';
        html += '</div>';
        
        container.innerHTML = html;
    }
    
    window.jumpToDate = function(dateStr, personName) {
        var date = new Date(dateStr);
        currentDate = new Date(date.getFullYear(), date.getMonth(), 1);
        saveCalendarState();
        loadEvents();
        
        document.getElementById('searchInput').value = '';
        document.getElementById('searchResults').innerHTML = '';
        
        setTimeout(function() {
            var dateKey = String(date.getMonth() + 1).padStart(2, '0') + '-' + String(date.getDate()).padStart(2, '0');
            selectedDate = dateKey;
            saveCalendarState();
            showEventsForDate(dateKey);
            highlightDay(date.getDate());
            
            setTimeout(function() {
                document.getElementById('eventsList').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }, 200);
    }
    
    function highlightDay(day) {
        var cells = document.querySelectorAll('.calendar-day');
        cells.forEach(function(cell) {
            var num = cell.querySelector('.calendar-day-number');
            if (num && parseInt(num.textContent) === day && !cell.classList.contains('other-month')) {
                cell.classList.add('highlighted');
                setTimeout(function() { cell.classList.remove('highlighted'); }, 4500);
            }
        });
    }
    
    function loadEvents() {
        var month = currentDate.getMonth() + 1;
        var year = currentDate.getFullYear();
        saveCalendarState();
        fetch(apiBase + '/api/calendar?month=' + month + '&year=' + year)
            .then(function(res) { return res.json(); })
            .then(function(data) {
                eventsData = data;
                renderCalendar();
                if (selectedDate) showEventsForDate(selectedDate);
            });
    }
    
    function renderCalendar() {
        var grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        dayNames.forEach(function(day) {
            var header = document.createElement('div');
            header.className = 'calendar-day-header';
            header.textContent = day;
            grid.appendChild(header);
        });
        
        var year = currentDate.getFullYear();
        var month = currentDate.getMonth();
        var firstDay = new Date(year, month, 1).getDay();
        var daysInMonth = new Date(year, month + 1, 0).getDate();
        var daysInPrevMonth = new Date(year, month, 0).getDate();
        
        for (var i = firstDay - 1; i >= 0; i--) grid.appendChild(createDayCell(daysInPrevMonth - i, true, false));
        for (var day = 1; day <= daysInMonth; day++) {
            var today = new Date();
            var isToday = today.getMonth() === month && today.getFullYear() === year && day === today.getDate();
            grid.appendChild(createDayCell(day, false, isToday));
        }
        var totalCells = grid.children.length - 7;
        var remainingCells = (Math.ceil(totalCells / 7) * 7) - totalCells;
        for (var day = 1; day <= remainingCells; day++) grid.appendChild(createDayCell(day, true, false));
        document.getElementById('monthYear').textContent = monthNames[month] + ' ' + year;
    }
    
    function createDayCell(day, otherMonth, isToday) {
        var cell = document.createElement('div');
        cell.className = 'calendar-day' + (otherMonth ? ' other-month' : '') + (isToday ? ' today' : '');
        var dateKey = String(currentDate.getMonth() + (otherMonth ? (day > 15 ? 0 : 2) : 1)).padStart(2, '0') + '-' + String(day).padStart(2, '0');
        var events = eventsData[dateKey] || [];
        
        if (events.length > 0 && !otherMonth) {
            cell.className += ' has-events';
            cell.onclick = function() { selectedDate = dateKey; saveCalendarState(); showEventsForDate(dateKey); };
        }
        
        var number = document.createElement('div');
        number.className = 'calendar-day-number';
        number.textContent = day;
        cell.appendChild(number);
        
        if (events.length > 0) {
            var count = document.createElement('div');
            count.className = 'event-count';
            count.textContent = events.length;
            cell.appendChild(count);
            
            var badges = document.createElement('div');
            badges.className = 'calendar-events-badges';
            events.forEach(function(event) {
                var badge = document.createElement('span');
                badge.className = 'event-badge ' + event.type;
                badge.textContent = event.type === 'birth' ? 'üéÇ' : 'üïØÔ∏è';
                badges.appendChild(badge);
            });
            cell.appendChild(badges);
        }
        return cell;
    }
    
    function showEventsForDate(dateKey) {
        var events = eventsData[dateKey] || [];
        var listEl = document.getElementById('eventsList');
        if (events.length === 0) { listEl.innerHTML = ''; return; }
        var parts = dateKey.split('-');
        var html = '<h2 style="margin-bottom: 0.9rem; color: var(--fg); font-size: 1.15rem;">–°—ä–±–∏—Ç–∏—è –Ω–∞ ' + parts[1] + ' ' + monthNames[parseInt(parts[0]) - 1] + '</h2>';
        events.forEach(function(event) {
            html += '<a href="address.html?slug=' + encodeURIComponent(event.slug) + '" class="event-card">';
            html += '<div class="event-icon">' + (event.type === 'birth' ? 'üéÇ' : 'üïØÔ∏è') + '</div>';
            html += '<div class="event-content"><div class="event-name">' + event.name + '</div>';
            html += '<div class="event-date">' + (event.type === 'birth' ? '–†–æ–¥–µ–Ω' : '–ü–æ—á–∏–Ω–∞–ª') + ' –Ω–∞ ' + event.full_date + '</div>';
            html += '<div class="event-years">–ü—Ä–µ–¥–∏ ' + event.years_ago + ' ' + (event.years_ago === 1 ? '–≥–æ–¥–∏–Ω–∞' : '–≥–æ–¥–∏–Ω–∏') + '</div></div></a>';
        });
        listEl.innerHTML = html;
        listEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    
    document.getElementById('prevMonth').addEventListener('click', function() { currentDate.setMonth(currentDate.getMonth() - 1); selectedDate = null; document.getElementById('eventsList').innerHTML = ''; saveCalendarState(); loadEvents(); });
    document.getElementById('nextMonth').addEventListener('click', function() { currentDate.setMonth(currentDate.getMonth() + 1); selectedDate = null; document.getElementById('eventsList').innerHTML = ''; saveCalendarState(); loadEvents(); });
    document.getElementById('todayBtn').addEventListener('click', function() { currentDate = new Date(); selectedDate = null; document.getElementById('eventsList').innerHTML = ''; saveCalendarState(); loadEvents(); });
    
    document.getElementById('year').textContent = new Date().getFullYear();
    loadEvents();
    loadAllPeople();
})();
</script>
</body>
</html>
