<!doctype html>
<html lang="en" data-theme="dark">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ĞĞ´Ñ€ĞµÑÑŠÑ‚ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸ÑÑ‚Ğ°- Ğ”Ğ¾Ğ¼Ğ¾Ğ²Ğµ</title>
	<meta name="description" content="Browse all historic addresses.">
	<link rel="icon" href="/assets/img/HistAdrLogoOrig.ico">
	<script>
		// Apply theme immediately to prevent flash
		(function() {
			try {
				var stored = localStorage.getItem('theme-preference');
				if (stored === 'system') stored = 'dark';
				var theme = (stored === 'dark' || stored === 'light') ? stored : 'dark';
				document.documentElement.setAttribute('data-theme', theme);
			} catch(e) {}
		})();
	</script>
	<link rel="stylesheet" href="assets/css/styles.css">
	<script src="assets/js/theme.js"></script>
	<script src="assets/js/transitions.js"></script>
    <style>
        /* Ğ¡Ñ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ Ğ·Ğ° Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ° Ğ·Ğ° Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ */
        .grid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .load-more-container {
            padding: 2rem 0;
            text-align: center;
        }
        .load-more-btn {
            /* ĞĞ±Ğ¸ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸ ÑÑ‚Ğ¸Ğ»Ğ¾Ğ²Ğµ Ğ·Ğ° Ğ±ÑƒÑ‚Ğ¾Ğ½ */
            background-color: #3b82f6; 
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }
        .load-more-btn:hover {
            background-color: #2563eb; 
        }
    </style>
</head>
<body>
	<header class="site-header">
		<a class="logo-link" href="index.html">
Â  Â  Â  Â  <img src="assets/img/HistAdrLogo.png" alt="ĞĞ´Ñ€ĞµÑÑŠÑ‚ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸ÑÑ‚Ğ°" class="header-logo">
Â  Â  Â  Â  <span class="logo-text">ĞĞ´Ñ€ĞµÑÑŠÑ‚ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸ÑÑ‚Ğ°</span>
Â  Â  </a>
		<nav class="nav">
			<a href="index.html">ĞĞ°Ñ‡Ğ°Ğ»Ğ¾</a>
			<a href="map.html">ĞšĞ°Ñ€Ñ‚Ğ°</a>
			<a href="addresses.html">Ğ”Ğ¾Ğ¼Ğ¾Ğ²Ğµ</a>
			<a href="about.html">Ğ—Ğ° ĞĞ°Ñ</a>
		</nav>
		<button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode"></button>
	</header>

	<main class="container">
		<h1 class="page-title gradient-text">ğŸ¡ Ğ¡Ğ¿Ğ¸ÑÑŠĞº Ğ½Ğ° Ğ°Ğ´Ñ€ĞµÑĞ¸Ñ‚Ğµ</h1>
		<div class="toolbar">
			<input id="q" class="input" type="search" placeholder="Ğ¢ÑŠÑ€ÑĞµĞ½Ğµ Ğ½Ğ° Ğ°Ğ´Ñ€ĞµÑĞ¸ Ğ¿Ğ¾ Ğ¸Ğ¼Ğµ, Ñ‚Ğ°Ğ³, Ğ¸Ğ·Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº..." aria-label="Search">
			<select id="tag" class="select" aria-label="Filter by tag">
				<option value="">Ğ’ÑĞ¸Ñ‡ĞºĞ¸ Ñ‚Ğ°Ğ³Ğ¾Ğ²Ğµ</option>
			</select>
		</div>
        
		<!-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ… Ğ½Ğ¾Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ·Ğ° Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ñ€ĞµÑˆĞµÑ‚ĞºĞ°Ñ‚Ğ° Ğ¸ Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ° -->
		<div id="grid-container" class="grid-container">
            <div id="grid" class="grid" aria-live="polite"></div>
            <!-- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ·Ğ° Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ° "Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ Ğ¾Ñ‰Ğµ" -->
            <div id="load-more-container" class="load-more-container">
                <button id="load-more-btn" class="load-more-btn" style="display: none;">Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ Ğ¾Ñ‰Ğµ</button>
            </div>
        </div>
	</main>

	<footer class="site-footer">
		<p>Â© <span id="year"></span> ĞĞ´Ñ€ĞµÑÑŠÑ‚ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸ÑÑ‚Ğ°</p>
	</footer>

	<script>
	(function() {
		var params = new URLSearchParams(location.search);
		var initialTag = (params.get('tag')||'').toLowerCase();
		var people = [];
		
        // --- ĞĞĞ’Ğ˜ ĞŸĞ ĞĞœĞ•ĞĞ›Ğ˜Ğ’Ğ˜ Ğ—Ğ ĞŸĞĞ“Ğ˜ĞĞĞ¦Ğ˜Ğ¯ ---
        const BATCH_SIZE = 20; // ĞšĞ¾Ğ»ĞºĞ¾ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ´Ğ° ÑĞµ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ñ‚ Ğ½Ğ°Ğ²ĞµĞ´Ğ½ÑŠĞ¶
        let currentBatchEnd = BATCH_SIZE; // ĞšÑ€Ğ°ÑÑ‚ Ğ½Ğ° Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ (Ğ·Ğ°Ğ¿Ğ¾Ñ‡Ğ²Ğ° Ğ¾Ñ‚ 20)
        // ------------------------------------

		// Fetch homes from API
		var apiBase = window.location.protocol === 'file:' ? 'http://localhost:3000' : window.location.origin;
		fetch(apiBase + '/api/homes')
			.then(function(res){Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Network response was not ok: ' + res.statusText);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return res.json();Â 
Â  Â  Â  Â  Â  Â  })
			.then(function(data){
				// Check if data is an array before filtering
Â  Â  Â  Â  Â  Â  Â  Â  if (!Array.isArray(data)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('API did not return an array. Received:', data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Server data format is incorrect.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  people = data.filter(function(p){ return p && p.published; });
				people.sort(function(a,b){ return (a.name || '').localeCompare(b.name || ''); });
				initialize();
			})
			.catch(function(err){
				console.error('Error loading homes:', err);
				// Use a message box instead of alert()
				document.getElementById('grid').innerHTML = '<p class="error-message">Ğ“Ñ€ĞµÑˆĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° Ğ´Ğ¾Ğ¼Ğ¾Ğ²ĞµÑ‚Ğµ Ğ¾Ñ‚ ÑÑŠÑ€Ğ²ÑŠÑ€Ğ°. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµÑ‚Ğµ ĞºĞ¾Ğ½Ğ·Ğ¾Ğ»Ğ°Ñ‚Ğ° Ğ·Ğ° Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸.</p>';
			});
		
		function initialize() {

		var tagSel = document.getElementById('tag');
		var tagSet = new Set();
		people.forEach(function(p){ (p.tags||[]).forEach(function(t){ if (t) tagSet.add(String(t)); }); });
		Array.from(tagSet).sort(function(a,b){ return a.localeCompare(b); }).forEach(function(t){
			var o=document.createElement('option'); o.value=t; o.textContent=t; tagSel.appendChild(o);
		});
		if (initialTag) {
			// Try to select matching tag ignoring case
			var match = Array.from(tagSel.options).find(function(o){ return o.value.toLowerCase() === initialTag; });
			if (match) tagSel.value = match.value;
		}
        
        // Ğ’Ğ·ĞµĞ¼Ğ°Ğ½Ğµ Ğ½Ğ° Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ° Ğ·Ğ° Ğ·Ğ°Ñ€ĞµĞ¶Ğ´Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¾Ñ‰Ğµ
        var loadMoreBtn = document.getElementById('load-more-btn');
        loadMoreBtn.addEventListener('click', function() {
            // Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ°Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° ĞºÑ€Ğ°Ñ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸ÑÑ‚Ğ° Ğ¸ Ñ€ĞµĞ½Ğ´Ğ¸Ñ€Ğ°Ğ½Ğµ (Ğ´Ğ¾Ğ±Ğ°Ğ²ÑĞ½Ğµ ĞºÑŠĞ¼ ÑÑŠÑ‰ĞµÑÑ‚Ğ²ÑƒĞ²Ğ°Ñ‰Ğ¾Ñ‚Ğ¾)
            currentBatchEnd += BATCH_SIZE;
            render(false); 
        });
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸ÑÑ‚Ğ° Ğ·Ğ° ÑÑ‚Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ñ‚ÑŠÑ€ÑĞµĞ½Ğµ/Ñ„Ğ¸Ğ»Ñ‚ÑŠÑ€ (Ğ²Ğ¸Ğ½Ğ°Ğ³Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ñ‡Ğ²Ğ° Ğ¾Ñ‚ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ñ‚Ğ¾)
        function startRender() {
            currentBatchEnd = BATCH_SIZE; // Ğ ĞµÑÑ‚Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ÑÑ‚Ğ°
            render(true); // Ğ—Ğ°Ğ¿Ğ¾Ñ‡Ğ²Ğ°Ğ¼Ğµ Ğ¾Ñ‚ Ğ½ÑƒĞ»Ğ°Ñ‚Ğ° (Ñ‡Ğ¸ÑÑ‚Ğ¸Ğ¼ Ñ€ĞµÑˆĞµÑ‚ĞºĞ°Ñ‚Ğ°)
        }


		function render(clearGrid = true) {
			var q = (document.getElementById('q').value || '').toLowerCase();
			var t = (tagSel.value||'').toLowerCase();
            
            // 1. Ğ¤Ğ¸Ğ»Ñ‚Ñ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° Ğ²ÑĞ¸Ñ‡ĞºĞ¸ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¸ ÑĞ¿Ğ¾Ñ€ĞµĞ´ Ñ‚ÑŠÑ€ÑĞµĞ½ĞµÑ‚Ğ¾ Ğ¸ Ñ‚Ğ°Ğ³Ğ°
			var filteredList = people.filter(function(p){
				var tagsLc = (p.tags||[]).map(function(x){ return String(x).toLowerCase(); });
				var hit = !q || (
					(p.name||'').toLowerCase().includes(q) ||
					(p.biography||'').toLowerCase().includes(q) ||
					(p.sources||[]).join(' ').toLowerCase().includes(q) ||
					tagsLc.join(' ').includes(q)
				);
				var tagOk = !t || tagsLc.includes(t);
				return hit && tagOk;
			});
            
            // 2. Ğ’Ğ·ĞµĞ¼Ğ°Ğ½Ğµ ÑĞ°Ğ¼Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸ÑÑ‚Ğ°, ĞºĞ¾ÑÑ‚Ğ¾ Ñ‚Ñ€ÑĞ±Ğ²Ğ° Ğ´Ğ° ÑĞµ Ñ€ĞµĞ½Ğ´Ğ¸Ñ€Ğ°
            var listToRender = filteredList.slice(0, currentBatchEnd);
            
			var grid = document.getElementById('grid');
            
            if (clearGrid) {
                grid.innerHTML = ''; // Ğ§Ğ¸ÑÑ‚Ğ¸Ğ¼ Ñ€ĞµÑˆĞµÑ‚ĞºĞ°Ñ‚Ğ° ÑĞ°Ğ¼Ğ¾ Ğ¿Ñ€Ğ¸ Ğ½Ğ¾Ğ²Ğ¾ Ñ‚ÑŠÑ€ÑĞµĞ½Ğµ/Ñ„Ğ¸Ğ»Ñ‚ÑŠÑ€
            }
			
			if (filteredList.length === 0) {
				grid.innerHTML = '<p class="text-center text-gray-500">ĞÑĞ¼Ğ° Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ¸ Ğ°Ğ´Ñ€ĞµÑĞ¸, Ğ¾Ñ‚Ğ³Ğ¾Ğ²Ğ°Ñ€ÑÑ‰Ğ¸ Ğ½Ğ° ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸Ñ‚Ğµ.</p>';
			} 

            // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ½Ğµ Ğ½Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ½Ğ¸Ñ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ·Ğ° Ñ€ĞµĞ½Ğ´Ğ¸Ñ€Ğ°Ğ½Ğµ (Ğ°ĞºĞ¾ Ğ½Ğµ Ñ‡Ğ¸ÑÑ‚Ğ¸Ğ¼, Ğ·Ğ°Ğ¿Ğ¾Ñ‡Ğ²Ğ°Ğ¼Ğµ Ğ¾Ñ‚ ĞºÑ€Ğ°Ñ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¸ÑˆĞ½Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ)
            const startIndex = clearGrid ? 0 : currentBatchEnd - BATCH_SIZE;

            // 3. Ğ ĞµĞ½Ğ´Ğ¸Ñ€Ğ°Ğ½Ğµ ÑĞ°Ğ¼Ğ¾ Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ñ†ÑĞ»Ğ°Ñ‚Ğ° Ñ„Ğ¸Ğ»Ñ‚Ñ€Ğ¸Ñ€Ğ°Ğ½Ğ° Ğ»Ğ¸ÑÑ‚Ğ° (Ğ°ĞºĞ¾ clearGrid Ğµ true)
			listToRender.slice(startIndex).forEach(function(p){
				
				// --- Ğ›ĞĞ“Ğ˜ĞšĞ Ğ—Ğ SLUG (Ğ—Ğ°Ğ¿Ğ°Ğ·ĞµĞ½Ğ° Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ğ¸ÑˆĞ½Ğ°Ñ‚Ğ° Ğ²ĞµÑ€ÑĞ¸Ñ) ---
				var slugValue = p.slug;
				var idValue = p.id;
				var finalSlug = '';
				if (typeof slugValue === 'string' && slugValue) {
					finalSlug = slugValue;
				} else if (typeof slugValue === 'object' && slugValue !== null && slugValue.slug) {
					finalSlug = String(slugValue.slug); 
				} else if (typeof idValue === 'string' && idValue) {
					finalSlug = idValue;
				} else if (typeof idValue === 'object' && idValue !== null && idValue.id) {
					finalSlug = String(idValue.id); 
				}
				
				if (!finalSlug) {
					console.error('Skipping home because neither slug nor id is a valid string/property:', p.name, p);
					return;Â 
				}
				// ----------------------------------------------------


				var placeholder = 'assets/img/placeholder.svg';
				var img = (p.images && p.images[0] && p.images[0].path) ? p.images[0].path : placeholder;
				var el = document.createElement('a');
				el.className = 'thumb';
				el.href = 'address.html?slug=' + encodeURIComponent(finalSlug);Â 
				
				el.innerHTML = '<img alt="'+(p.images && p.images[0] && p.images[0].alt || ('Ğ¤Ğ°ÑĞ°Ğ´Ğ° Ğ½Ğ° '+p.name))+'" loading="lazy" src="'+img+'" onerror="this.onerror=null;this.src=\''+placeholder+'\';">' +
					'<div class="meta"><strong>'+p.name+'</strong><div class="muted">'+(p.address||'')+'</div></div>';
				grid.appendChild(el);
			});
            
            // 4. ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ°Ğ½Ğµ/Ğ¡ĞºÑ€Ğ¸Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ° "Ğ—Ğ°Ñ€ĞµĞ´Ğ¸ Ğ¾Ñ‰Ğµ"
            if (currentBatchEnd < filteredList.length) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none'; // Ğ¡ĞºÑ€Ğ¸Ğ²Ğ° ÑĞµ, Ğ°ĞºĞ¾ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ Ñ„Ğ¸Ğ»Ñ‚Ñ€Ğ¸Ñ€Ğ°Ğ½Ğ¸ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¸ ÑĞ° Ğ·Ğ°Ñ€ĞµĞ´ĞµĞ½Ğ¸
            }
		}

			document.getElementById('q').addEventListener('input', startRender); // Ğ˜Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ğ¼Ğµ startRender
			tagSel.addEventListener('change', startRender); // Ğ˜Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ğ¼Ğµ startRender
			startRender();
			document.getElementById('year').textContent = new Date().getFullYear();
		}
	})();
	</script>
</body>
</html>
